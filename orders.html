<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel | Buyurtmalar</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <link rel="icon" type="image/jpg" href="image/back.jpg">
<link rel="stylesheet" href="css/style.css">

  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; padding: 20px; }
    h2 { color: #ffb400; margin-bottom: 15px; }
    input, select { padding: 10px; margin: 5px 0; width: 100%; border-radius: 5px; border: none; }
    button { padding: 8px 12px; margin: 5px 0; background: #ffb400; color: #000; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #ffc833; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 12px; border-bottom: 1px solid #222; text-align: left; }
    th { background: #ffb400; color: #000; }
    tr:hover { background: #1b1b1b; }
  </style>
</head>
<body>
    

  <h2>ðŸ›’ Mahsulot qoâ€˜shish</h2>
  <input type="text" id="name" placeholder="Mahsulot nomi">
  <input type="text" id="price" placeholder="Narxi">
  <select id="category">
    <option value="kostyum">Kostyum</option>
    <option value="shim">Shim</option>
    <option value="kofta">Kofta</option>
    <option value="oyoq-kiyim">Oyoq kiyim</option>
  </select>
  <input type="file" id="imageFile">
  <button onclick="addProduct()">Mahsulot qoâ€˜shish</button>

  <h2>ðŸ“¦ Buyurtmalar roâ€˜yxati</h2>
  <table id="ordersTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Mijoz</th>
        <th>Telefon</th>
        <th>Mahsulotlar</th>
        <th>Jami narx</th>
        <th>Sana</th>
        <th>Holat</th>
        <th>Amallar</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // ðŸ”¥ Firebase sozlamasi
    const firebaseConfig = {
      apiKey: "AIzaSyBYf0yxerZxtHYrrshV3FfWvCrf4UfGqVw",
      authDomain: "newpremium-a4fe8.firebaseapp.com",
      databaseURL: "https://newpremium-a4fe8-default-rtdb.firebaseio.com",
      projectId: "newpremium-a4fe8",
      storageBucket: "newpremium-a4fe8.appspot.com",
      messagingSenderId: "288211585587",
      appId: "1:288211585587:web:f10bf78119baef6d98f146",
      measurementId: "G-33B97P3FD7"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();

    // ðŸ›ï¸ Mahsulot qoâ€˜shish
    function addProduct() {
      const name = document.getElementById("name").value;
      const price = document.getElementById("price").value;
      const category = document.getElementById("category").value;
      const file = document.getElementById("imageFile").files[0];

      if (!name || !price || !file) {
        alert("Iltimos barcha maydonlarni toâ€˜ldiring!");
        return;
      }

      const storageRef = storage.ref('products/' + file.name);
      storageRef.put(file).then(() => {
        storageRef.getDownloadURL().then(url => {
          db.ref("products").push({ name, price, category, imageUrl: url });
          alert("âœ… Mahsulot qoâ€˜shildi!");
          document.getElementById("name").value = "";
          document.getElementById("price").value = "";
          document.getElementById("imageFile").value = "";
        });
      });
    }

    // ðŸ”¹ Buyurtmalarni koâ€˜rsatish
    const tbody = document.querySelector("#ordersTable tbody");

    db.ref("orders").on("value", snapshot => {
      tbody.innerHTML = "";
      let i = 1;
      snapshot.forEach(child => {
        const order = child.val();
        const totalPrice = order.cart.reduce((sum, item) => sum + parseFloat(item.price), 0);
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i++}</td>
          <td>${order.name}</td>
          <td>${order.phone}</td>
          <td>
            <ul>
              ${order.cart.map(item => `<li>${item.name} - ${item.price} soâ€˜m</li>`).join('')}
            </ul>
          </td>
          <td>${totalPrice.toLocaleString()} soâ€˜m</td>
          <td>${order.date}</td>
          <td>${order.status || "Yangi"}</td>
          <td>
            <button onclick="markDone('${child.key}')">âœ… Bajarildi</button>
            <button onclick="deleteOrder('${child.key}')">ðŸ—‘ Oâ€˜chirish</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    });

    // âœ… Buyurtmani bajarilgan deb belgilash
    function markDone(id) {
      db.ref("orders/" + id).update({ status: "Bajarildi" });
      alert("Buyurtma bajarilgan deb belgilandi âœ…");
    }

    // ðŸ—‘ Buyurtmani oâ€˜chirish
    function deleteOrder(id) {
      if (confirm("Bu buyurtmani oâ€˜chirmoqchimisiz?")) {
        db.ref("orders/" + id).remove();
        alert("Buyurtma oâ€˜chirildi ðŸ—‘");
      }
    }
  </script>
</body>
</html>
