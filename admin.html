<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel | Exclusive Premium House</title>
<link rel="icon" type="image/png" href="../image/premiumm.jpg" />
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <link rel="icon" type="image/jpg" href="image/back.jpg">

<style>
  body{background:#0a0a0a;color:#fff;font-family:'Poppins',sans-serif;padding:20px;}
  h1{text-align:center;color:#ffb400;margin-bottom:20px;}
  .login-form, .admin-panel{max-width:600px;margin:50px auto;padding:25px;border:1px solid #ffb400;border-radius:12px;background:#111;}
  input,select{width:100%;padding:10px;margin:10px 0;border:none;border-radius:8px;background:#1b1b1b;color:#fff;}
  button{padding:10px 15px;border:none;border-radius:8px;background:#ffb400;color:#000;font-weight:bold;cursor:pointer;}
  button:hover{background:#ffc833;}
  table{width:100%;border-collapse:collapse;margin-top:20px;}
  th,td{padding:10px;text-align:left;border-bottom:1px solid #222;}
  th{background:#ffb400;color:#000;}
  .status{font-weight:bold;color:#00ff9d;}
</style>
</head>
<body>

<div class="login-form" id="loginForm">
  <h1>ğŸ” Admin Panelga kirish</h1>
  <input type="password" id="adminPassword" placeholder="Parolni kiriting">
  <button onclick="login()">Kirish</button>
  <p id="loginMsg" style="color:#ffb400;"></p>
</div>

<div class="admin-panel" id="adminPanel" style="display:none;">
  <h1>ğŸ‘‹ Xush kelibsiz, Admin!</h1>
  <button onclick="logout()" style="background:#c40000;color:#fff;margin-bottom:20px;">ğŸšª Chiqish</button>

  <h2>ğŸ“¦ Mahsulot qoâ€˜shish</h2>
  <input type="text" id="productName" placeholder="Mahsulot nomi">
  <input type="number" id="productPrice" placeholder="Narxi (soâ€˜m)">
  <input type="file" id="productImageFile" accept="image/*">
  
  </select>
  <button onclick="addProduct()">ğŸ“¤ Mahsulot qoâ€˜shish</button>
  <p id="statusMsg"></p>

  <h2>ğŸ“ Joriy mahsulotlar</h2>
  <table id="productsTable">
    <thead>
      <tr>
        <th>#</th><th>Nom</th><th>Narxi</th><th>Kategoriya</th><th>Rasm</th><th>Amallar</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>ğŸ“¦ Buyurtmalar</h2>
  <table id="ordersTable">
    <thead>
      <tr>
        <th>#</th><th>Mahsulot</th><th>Narxi</th><th>Mijoz</th><th>Telefon</th><th>Sana</th><th>Holat</th><th>Amallar</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  // === Firebase sozlamasi ===
  const firebaseConfig = {
    apiKey: "AIzaSyBYf0yxerZxtHYrrshV3FfWvCrf4UfGqVw",
    authDomain: "newpremium-a4fe8.firebaseapp.com",
    databaseURL: "https://newpremium-a4fe8-default-rtdb.firebaseio.com",
    projectId: "newpremium-a4fe8",
    storageBucket: "newpremium-a4fe8.appspot.com",
    messagingSenderId: "288211585587",
    appId: "1:288211585587:web:f10bf78119baef6d98f146"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // === Admin login ===
  const correctPassword = "aBRORbek1717";
  function login() {
    const pass = document.getElementById("adminPassword").value;
    if (pass === correctPassword) {
      localStorage.setItem("adminLoggedIn", "true");
      document.getElementById("loginForm").style.display="none";
      document.getElementById("adminPanel").style.display="block";
      loadProducts();
      loadOrders();
    } else {
      document.getElementById("loginMsg").textContent="âŒ Notoâ€˜gâ€˜ri parol!";
    }
  }
  function logout() {
    localStorage.removeItem("adminLoggedIn");
    location.reload();
  }
  if (localStorage.getItem("adminLoggedIn")==="true"){
    document.getElementById("loginForm").style.display="none";
    document.getElementById("adminPanel").style.display="block";
    loadProducts();
    loadOrders();
  }

  // === Mahsulot qoâ€˜shish (imgbb orqali rasm yuklash) ===
  const apiKey = "acd1f49b82fa499f80b2da4b3f983061"; // Sizning imgbb API kalitingiz

  async function addProduct() {
    const name = document.getElementById("productName").value.trim();
    const price = document.getElementById("productPrice").value.trim();
    const category = document.getElementById("productCategory").value;
    const file = document.getElementById("productImageFile").files[0];
    const statusMsg = document.getElementById("statusMsg");

    if (!name || !price || !file) {
      statusMsg.textContent = "âš ï¸ Barcha maydonlarni toâ€˜ldiring!";
      return;
    }

    statusMsg.textContent = "ğŸ“¤ Rasm yuklanmoqda...";

    const formData = new FormData();
    formData.append("image", file);

    try {
      const res = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      if (!data.success) throw new Error("Rasm yuklashda xatolik!");
      const imageUrl = data.data.url;

      await db.ref("products").push({ name, price, image: imageUrl, category });
      statusMsg.textContent = "âœ… Mahsulot muvaffaqiyatli qoâ€˜shildi!";
      document.getElementById("productName").value = "";
      document.getElementById("productPrice").value = "";
      document.getElementById("productImageFile").value = "";
    } catch (err) {
      console.error(err);
      statusMsg.textContent = "âŒ Xatolik: " + err.message;
    }
  }

  // === Mahsulotlar roâ€˜yxati ===
  function loadProducts(){
    const tbody = document.querySelector("#productsTable tbody");
    db.ref("products").on("value", snapshot=>{
      tbody.innerHTML="";
      let i=1;
      snapshot.forEach(child=>{
        const p=child.val();
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${i++}</td>
          <td>${p.name}</td>
          <td>${p.price}</td>
          <td>${p.category}</td>
          <td><img src="${p.image}" width="50"></td>
          <td><button onclick="deleteProduct('${child.key}')">ğŸ—‘ Oâ€˜chirish</button></td>
        `;
        tbody.appendChild(tr);
      });
    });
  }
  function deleteProduct(id){
    if(confirm("Bu mahsulotni oâ€˜chirmoqchimisiz?")) db.ref("products/"+id).remove();
  }

  // === Buyurtmalar ===
  function loadOrders(){
    const tbody = document.querySelector("#ordersTable tbody");
    db.ref("orders").on("value", snapshot=>{
      tbody.innerHTML="";
      let i=1;
      snapshot.forEach(child=>{
        const o=child.val();
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${i++}</td>
          <td>${o.productName}</td>
          <td>${o.price}</td>
          <td>${o.buyerName}</td>
          <td>${o.phone}</td>
          <td>${o.date}</td>
          <td class="status">${o.status||"Yangi"}</td>
          <td>
            <button onclick="markDone('${child.key}')">âœ… Bajarildi</button>
            <button onclick="deleteOrder('${child.key}')">ğŸ—‘ Oâ€˜chirish</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    });
  }
  function markDone(id){ db.ref("orders/"+id).update({status:"Bajarildi"}); }
  function deleteOrder(id){ if(confirm("Buyurtmani oâ€˜chirish?")) db.ref("orders/"+id).remove(); }
</script>
</body>
</html>
